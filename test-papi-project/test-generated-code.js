// Test file generated by our web UI
// This code should work immediately after running the setup commands

import { createClient } from "polkadot-api"
import { start } from "polkadot-api/smoldot"
import { getSmProvider } from "polkadot-api/sm-provider"
import { chainSpec } from "polkadot-api/chains/polkadot"
import { polkadot } from "./.papi/descriptors/dist/index.mjs"

async function testGeneratedCode() {
  console.log('ğŸš€ Starting PAPI test with generated code...');
  
  try {
    // Initialize smoldot
    console.log('ğŸ“¡ Initializing smoldot light client...');
    const smoldot = start();
    
    // Add chain
    console.log('ğŸ”— Adding Polkadot chain...');
    const chain = await smoldot.addChain({ 
      chainSpec 
    });
    console.log('âœ… Chain added successfully');
    
    // Create client
    console.log('ğŸ”Œ Creating PAPI client...');
    const client = createClient(getSmProvider(chain));
    console.log('âœ… Client created successfully');
    
    // Get typed API
    console.log('ğŸ“‹ Getting typed API...');
    const typedApi = client.getTypedApi(polkadot);
    console.log('âœ… Typed API obtained successfully');
    
    // Test a simple query
    console.log('ğŸ” Testing System.Number query...');
    const blockNumber = await typedApi.query.System.number();
    console.log('âœ… Block number query successful:', blockNumber);
    
    // Test getting account info
    console.log('ğŸ‘¤ Testing System.Account query...');
    const accountInfo = await typedApi.query.System.account("5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY");
    console.log('âœ… Account info query successful');
    console.log('   Nonce:', accountInfo.nonce);
    console.log('   Free balance:', accountInfo.data.free);
    
    // Test transaction creation (without submitting)
    console.log('ğŸ“ Testing transaction creation...');
    const call = typedApi.tx.Balances.transfer_allow_death({
      dest: "5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty",
      value: 1000000000000n
    });
    console.log('âœ… Transaction created successfully');
    
    // Get encoded data
    console.log('ğŸ” Getting encoded transaction data...');
    const encodedData = await call.getEncodedData();
    console.log('âœ… Transaction encoding successful, length:', encodedData.length);
    
    // Cleanup
    console.log('ğŸ§¹ Cleaning up...');
    smoldot.terminate();
    console.log('âœ… Smoldot terminated');
    
    console.log('ğŸ‰ ALL TESTS PASSED! Our generated code works perfectly!');
    
  } catch (error) {
    console.error('âŒ Test failed:', error);
    throw error;
  }
}

// Run the test
testGeneratedCode().catch(console.error);
