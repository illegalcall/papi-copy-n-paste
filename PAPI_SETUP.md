# PAPI v1.14+ Setup Guide

This project uses real chain descriptors generated by the PAPI CLI for type-safe blockchain interactions.

## Quick Setup

To get this project working on your system:

### 1. Install Dependencies
```bash
# Install project dependencies  
npm install

# Install PAPI CLI globally
npm install -g polkadot-api
```

### 2. Generate Descriptors

The project needs chain descriptors to work with PAPI v1.14+. Run these commands to generate them:

```bash
# Generate descriptors for all supported chains
papi add polkadot --wsUrl wss://rpc.polkadot.io
papi add kusama --wsUrl wss://kusama-rpc.polkadot.io  
papi add moonbeam --wsUrl wss://wss.api.moonbeam.network
papi add bifrost --wsUrl wss://hk.p.bifrost-rpc.liebi.com/ws
papi add astar --wsUrl wss://rpc.astar.network

# Build the descriptors
papi generate

# Install and build the project
npm install
npm run dev
```

### 3. Verify Setup

After running the commands above, you should see:

- `.papi/` directory created in the project root
- `.papi/descriptors/dist/` containing generated descriptors  
- No TypeScript compilation errors
- The app running at `http://localhost:3000`

## What Gets Generated

The PAPI CLI creates:

- **Metadata files**: `.papi/metadata/*.scale` - Raw chain metadata
- **Descriptors**: `.papi/descriptors/dist/*` - TypeScript types and API definitions  
- **Config**: `.papi/polkadot-api.json` - Chain configuration

## Supported Chains

### With Real Descriptors
- **Polkadot**: `wss://rpc.polkadot.io`
- **Kusama**: `wss://kusama-rpc.polkadot.io`  
- **Moonbeam**: `wss://wss.api.moonbeam.network`
- **Bifrost**: `wss://hk.p.bifrost-rpc.liebi.com/ws`
- **Astar**: `wss://rpc.astar.network`

### With Fallback Descriptors
- **Acala**: Uses Polkadot descriptor as fallback
- **Hydration**: Uses Polkadot descriptor as fallback

*Note: Some endpoints had connection issues during generation. You can add these later when endpoints are stable.*

## Adding New Chains

To add a new chain:

```bash
# Add the new chain
papi add <chain-name> --wsUrl <websocket-url>

# Regenerate descriptors  
papi generate

# Update the project
npm install
```

Then update `packages/core/descriptors.ts` to include the new chain in `CHAIN_DESCRIPTORS`.

## Troubleshooting

### Build Errors
- **"Could not resolve polkadot-api"**: Run `papi generate` to build descriptors
- **"No descriptors found"**: Make sure you ran `papi add` for the chains
- **TypeScript errors**: Verify `.papi/descriptors/dist/` exists and has files

### Connection Issues
- **Timeout errors**: Some endpoints are slow or unstable - try again later
- **Method not found**: The endpoint might not support PAPI's metadata calls
- **Authentication**: Make sure you're not behind a proxy blocking WebSocket connections

### Missing Chains
If a chain fails to generate:
1. The endpoint might be down - try alternative RPC endpoints
2. The chain might not be compatible with PAPI  
3. Network connectivity issues

## Technical Details

### Architecture
- **Descriptors**: Generated TypeScript types for each chain
- **Client Pattern**: Uses `client.getTypedApi(descriptor)` (PAPI v1.14+)
- **Type Safety**: Full TypeScript support for all transactions and queries
- **No Fallbacks**: Real blockchain interactions, no mock data

### File Structure
```
.papi/
├── descriptors/dist/        # Generated TypeScript descriptors
├── metadata/               # Raw chain metadata (.scale files)  
└── polkadot-api.json      # PAPI configuration

packages/core/
└── descriptors.ts          # Chain descriptor mapping
```

### Code Generation
The app generates proper PAPI v1.14+ code:

```typescript
import { createClient } from "polkadot-api"
import { polkadot } from "@polkadot-api/descriptors"

const client = createClient(/* provider */)
const typedApi = client.getTypedApi(polkadot)
const tx = typedApi.tx.Balances.transfer_allow_death({
  dest: "5GrwvaEF...",
  value: 1000000000000n
})
```

## FAQ

**Q: Do I need to regenerate descriptors often?**
A: Only when chains upgrade their runtime. The generated descriptors are version-specific.

**Q: Can I use different RPC endpoints?**
A: Yes, but you'll need to regenerate descriptors: `papi add <chain> --wsUrl <new-url>`

**Q: Why are some chains using fallback descriptors?**  
A: Their RPC endpoints had connection issues during generation. They'll use Polkadot's descriptor structure.

**Q: How do I know if my setup is working?**
A: The app should load without TypeScript errors and show chain data when you select a chain.

---

For more information, see the [PAPI documentation](https://papi.how/docs/).